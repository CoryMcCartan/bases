<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bayesian Additive Regression Tree (BART) features — b_bart • bases</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Additive Regression Tree (BART) features — b_bart"><meta name="description" content="Generates random features from a BART prior on symmetric trees. Equivalently,
the features are the interaction of a small number of indicator functions.
The number of interacted indicators is the depth of the symmetric tree, and
is drawn from a prior on the tree depth which is calibrated to match the
traditional BART prior of Chipman et al. (2010). The variable at each tree
node is selected uniformly, and thresholds are selected uniformly from the
range of each variable."><meta property="og:description" content="Generates random features from a BART prior on symmetric trees. Equivalently,
the features are the interaction of a small number of indicator functions.
The number of interacted indicators is the depth of the symmetric tree, and
is drawn from a prior on the tree depth which is calibrated to match the
traditional BART prior of Chipman et al. (2010). The variable at each tree
node is selected uniformly, and thresholds are selected uniformly from the
range of each variable."><meta property="og:image" content="http://corymccartan.com/bases/logo.png"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2KH5JZ6JS1"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-2KH5JZ6JS1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bases</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/prediction.html">Valid Prediction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CoryMcCartan/bases/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bayesian Additive Regression Tree (BART) features</h1>
      <small class="dont-index">Source: <a href="https://github.com/CoryMcCartan/bases/blob/main/R/b_bart.R" class="external-link"><code>R/b_bart.R</code></a></small>
      <div class="d-none name"><code>b_bart.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates random features from a BART prior on symmetric trees. Equivalently,
the features are the interaction of a small number of indicator functions.
The number of interacted indicators is the depth of the symmetric tree, and
is drawn from a prior on the tree depth which is calibrated to match the
traditional BART prior of Chipman et al. (2010). The variable at each tree
node is selected uniformly, and thresholds are selected uniformly from the
range of each variable.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">b_bart</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  trees <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  depths <span class="op">=</span> <span class="fu">bart_depth_prior</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>,</span>
<span>  vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thresh <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ranges <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bart_depth_prior</span><span class="op">(</span>mean_depth <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>The variable(s) to build features for. A single data frame or
matrix may be provided as well. Missing values are not allowed.</p></dd>


<dt id="arg-trees">trees<a class="anchor" aria-label="anchor" href="#arg-trees"></a></dt>
<dd><p>The number of trees to sample.</p></dd>


<dt id="arg-depths">depths<a class="anchor" aria-label="anchor" href="#arg-depths"></a></dt>
<dd><p>The depths of each tree. By default, these are drawn from a
Poisson distribution calibrated to produce trees with around 2.5 leaves, on
average, matching the traditional BART prior.</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>Integer indices of the variables to use for each tree. If
provided, overrides those generated automatically by sampling uniformly
from the available input features. Provided in flat form, so should have
length equal to <code>sum(depths)</code>.</p></dd>


<dt id="arg-thresh">thresh<a class="anchor" aria-label="anchor" href="#arg-thresh"></a></dt>
<dd><p>The thresholds for each variable. If provided, overrides those
generated automatically by sampling uniformly from <code>ranges</code>, which defaults
to the range of each input feature. Provided in flat form, so should have
length equal to <code>sum(depths)</code>.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>Columns in the calculated indicator matrix to drop. By default,
any leaves which match zero input rows are dropped.  If provided, overrides
this default.</p></dd>


<dt id="arg-ranges">ranges<a class="anchor" aria-label="anchor" href="#arg-ranges"></a></dt>
<dd><p>The range of the input features, provided as a matrix with two
rows and a column for each input feature. The first row is the minimum and
the second row is the maximum.</p></dd>


<dt id="arg-mean-depth">mean_depth<a class="anchor" aria-label="anchor" href="#arg-mean-depth"></a></dt>
<dd><p>The mean prior depth of each tree, where a single node has
depth zero and a two-leaf tree has depth 1. This value minus one becomes
the rate parameter of a Poisson distribution, whose samples are then
shifted up by one. In this way, no zero-depth trees (which produce trivial
features) are sampled.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A matrix of indicator variables encoding the random features.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>bart_depth_prior()</code>: Poisson depth prior for random trees, parametrized in
terms of mean tree depth. Returns a function which generates samples from
the prior with argument giving the number of samples. The default prior
closely matches the average number of leaves in the original (asymmetric)
BART prior.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hugh A. Chipman. Edward I. George. Robert E. McCulloch. "BART:
Bayesian additive regression trees." Ann. Appl. Stat. 4 (1) 266 - 298,
March 2010. https://doi.org/10.1214/09-AOAS285</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu">b_bart</span><span class="op">(</span><span class="va">cyl</span>, <span class="va">disp</span>, <span class="va">hp</span>, <span class="va">drat</span>, <span class="va">wt</span>, trees <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># TRUE; empty leaves are pruned away</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># each row belongs to 1 leaf node per tree; some trees pruned away</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">50</span><span class="op">)</span> <span class="co"># TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">150</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">BJsales</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="ridge.html">ridge</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">b_bart</span><span class="op">(</span><span class="va">x</span>, trees<span class="op">=</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"s"</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="b_bart-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cory McCartan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

